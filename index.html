<!DOCTYPE html>
<html>
<head>
	<title>cum-municator with websockets ðŸ˜³</title>
	<meta charset="utf-8">
	<script>
		let ws = null;
		let ipaddr = null;

		window.addEventListener("load", (evt) => {
			fetch("/ip").then(response => {
				response.text().then(ipaddrfetched => {
					ipaddr = ipaddrfetched;
					ws = new WebSocket("ws://" + ipaddr + ":80/chat");	//address to connect to, /chat triggers go chat function
					
					ws.onmessage = msg => updateChat(msg);
					ws.onclose = () => alert("chat connection closed");
				});
			});
		});

		function updateChat(msg) {
			document.getElementById("chatLog").innerHTML += msg.data + "<br>";
		}

		function postTextBox() {
			ws.send(document.getElementById("nickInput").value + ": " + document.getElementById("chatInput").value);
			document.getElementById("chatInput").value = "";
		}

		window.onkeydown = function(e) {
			if(e.code == "Enter") {
				postTextBox();
			}
		};
	</script>
</head>

<body>
	<div id="chatLog"></div>
	<br>	

	<label for="nickInput">Nickname:</label>
	<input type="text" id="nickInput" name="nickInput"></input>
	<label for="chatInput">Post:</label>
	<input type="text" id="chatInput" name="chatInput"></input>
	<button id="chatButton" onclick="postTextBox()">post</button>
	<a href="/amogus.html"><button id="amongus">amogus</button></a>
</body>
</html>
