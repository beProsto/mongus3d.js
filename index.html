<!DOCTYPE html>
<html>
<head>
	<title>beProsto's communicator</title>
	<meta charset="utf-8">
	<script>
		const comDataUrl = "https://beprosto.github.io/outofthebox/data/com.dat";
		async function getChatText() {
			let data = await fetch(comDataUrl);
			data.text().then(function (text) {
				console.log("update!");
				document.getElementById("chatLog").innerHTML = text;
			});
		}
		getChatText();
		async function postTextBox() {
			let xhr = new XMLHttpRequest();
			xhr.open("PUT", comDataUrl); 
			xhr.onload = function () {
				let txt = xhr.responseText;
				if (xhr.readyState == 4 && (xhr.status == "201" || xhr.status == "200")) {
					console.log(txt);
				} else {
					console.error(txt);
				}
			};
			let toSend = document.getElementById("chatInput").value;
			xhr.send(toSend);
			document.getElementById("chatInput").value = "";
			await getChatText();
		}

		window.onkeydown = async function(e) {
			if(e.code == "Enter") {
				await postTextBox();
			}
		};

		setInterval(getChatText, 350);
	</script>
</head>

<body>
	<div id="chatLog"></div>
	<label for="chatInput">></label>
	<input type="text" id="chatInput" name="chatInput"></input>
</body>
</html>
