<!DOCTYPE html>
<html>
<head>
	<title>cum-municator</title>
	<meta charset="utf-8">
	<script>
		const comDataUrl = "/chatdata.txt";

		function getChatText() {
			let xhr = new XMLHttpRequest();
			xhr.open("GET", comDataUrl);
			xhr.onload = function () {
				let txt = xhr.responseText;
				if (xhr.readyState == 4 && (xhr.status == "201" || xhr.status == "200")) {
					console.log("update!");
					document.getElementById("chatLog").innerHTML = txt;
				} else {
					console.error(txt);
				}
			};
			xhr.send();
		}
		function postTextBox() {
			if(document.getElementById("nickInput").value) {
				let xhr = new XMLHttpRequest();
				xhr.open("PUT", comDataUrl); 
				xhr.onload = function () {
					let txt = xhr.responseText;
					if (xhr.readyState == 4 && (xhr.status == "201" || xhr.status == "200")) {
						console.log(txt);
					} else {
						console.error(txt);
					}
				};
				let toSend = document.getElementById("nickInput").value + ": " + document.getElementById("chatInput").value + "<br>";
				xhr.send(toSend);
				document.getElementById("chatInput").value = "";
			}
			else {
				alert("Nickname se ustaw wpierw");
			}
		}

		window.onkeydown = function(e) {
			if(e.code == "Enter") {
				postTextBox();
			}
		};

		getChatText();
		setInterval(getChatText, 300);
	</script>
</head>

<body>
	<div id="chatLog"></div>
	<br>	

	<label for="nickInput">Nickname:</label>
	<input type="text" id="nickInput" name="nickInput"></input>
	<label for="chatInput">Post:</label>
	<input type="text" id="chatInput" name="chatInput"></input>
	<button id="chatButton" onclick="postTextBox()">post</button>
	<a href="/amogus.html"><button id="amongus">amogus</button></a>
</body>
</html>
